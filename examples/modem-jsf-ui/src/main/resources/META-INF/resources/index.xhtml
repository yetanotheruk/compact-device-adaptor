<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
>

<h:head>
    <title>Modem Management System</title>
    <h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css?version=#{startup.time}"/>
    <h:outputStylesheet library="css" name="default.css"/>

</h:head>

<body>
<h:form id="app-form">

    <p:remoteCommand name="configApplied" action="#{modemDataBean.refreshSummary()}" update=":app-form"/>

    <p:panel styleClass="app-container" style="background-color:#17212f;">
        <div class="grid">
            <div class="flex-grow-1 col-3">
                <p:card style="margin: 2em; background-color:#304562; height: 200px;">
                    <f:facet name="title">
                        Modem Infomation
                    </f:facet>

                    <span style="font-weight:bold"> Id: </span><p:outputLabel value="#{modemDataBean.summary.modemId}"/><br/>
                    <span style="font-weight:bold"> Active: </span><i
                        class="pi #{modemDataBean.summary.active ? 'pi-check-circle' : 'pi-times-circle'}"/><br/>
                    <span style="font-weight:bold"> Software Version: </span><p:outputLabel
                        value="#{modemDataBean.summary.softwareVersion}"/><br/>
                    <span style="font-weight:bold"> Firmware Version: </span><p:outputLabel
                        value="#{modemDataBean.summary.firmwareVersion}"/><br/>
                </p:card>
            </div>

            <div class="flex-grow-1 col-3">
                <p:card style="margin: 2em; background-color:#304562; height: 200px;">
                    <f:facet name="title">
                        Key Status
                    </f:facet>

                    <span style="font-weight:bold"> Loaded: </span><i
                        class="pi #{modemDataBean.summary.keysLoaded ? 'pi-check-circle' : 'pi-times-circle'}"/><br/>
                    <span style="font-weight:bold"> Valid Until: </span><p:outputLabel
                        value="#{transformBean.dateToString(modemDataBean.summary.keysValidUntil)}"/>
                </p:card>
            </div>

            <div class="flex-grow-1 col-3">
                <p:card style="margin: 2em; background-color:#304562; height: 200px;">
                    <f:facet name="title">
                        Configuration Status
                    </f:facet>

                    <span style="font-weight:bold"> Configuration: </span><p:outputLabel
                        value="#{modemDataBean.summary.configurationName}"/><br/>
                    <span style="font-weight:bold"> Satellite: </span><p:outputLabel
                        value="#{modemDataBean.summary.satellite}"/><br/>
                    <span style="font-weight:bold"> Applied On: </span><p:outputLabel
                        value="#{transformBean.dateToString(modemDataBean.summary.configurationAppliedOn)}"/><br/>
                    <span style="font-weight:bold"> Power: </span><p:outputLabel
                        value="#{modemDataBean.summary.power}"/>dB

                </p:card>
            </div>

            <div class="flex-grow-1 col-3">
                <p:card style="margin: 2em; background-color:#304562; height: 200px;">
                    <f:facet name="title">
                        Service Status
                    </f:facet>

                    <span style="font-weight:bold"> GPS: </span><p:outputLabel
                        value="#{modemDataBean.summary.gps}"/><br/>
                    <span style="font-weight:bold"> 1PPS: </span><p:outputLabel
                        value="#{modemDataBean.summary.onepps}"/><br/>
                    <span style="font-weight:bold"> NTP: </span><p:outputLabel value="#{modemDataBean.summary.ntp}"/>

                </p:card>
            </div>
        </div>

        <div class="grid">
            <div class="col-1">
                <p:fragment>

                    <p:commandButton icon="pi pi-home" styleClass="rounded-button ui-button-info"
                                     action="#{modemDataBean.changePage('HOME')}"
                                     update=":app-form"
                                     style="margin-left: 40%;"/><br/><br/>
                    <p:commandButton icon="pi pi-chart-line" styleClass="rounded-button ui-button-info"
                                     action="#{modemDataBean.changePage('CHARTS')}"
                                     update=":app-form"
                                     style="margin-left: 40%;"/><br/><br/>
                    <p:commandButton icon="pi pi-cog" styleClass="rounded-button ui-button-info"
                                     action="#{modemDataBean.changePage('SETTINGS')}"
                                     update=":app-form"
                                     style="margin-left: 40%;"/><br/><br/>

                    <p:spacer height="450px"/>
                </p:fragment>
            </div>
            <div class="col-11">

                <p:panel rendered="#{modemDataBean.page == 'HOME'}">
                    <p:dataTable var="pack" value="#{configurationsBean.model}" rows="5"
                                 paginator="true" paginatorPosition="bottom"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                                 rowsPerPageTemplate="5,10,20"
                                 scrollable="true"
                                 scrollHeight="100%">

                        <p:column headerText="Name">
                            <h:outputText value="#{pack.externalReference}"/>
                        </p:column>

                        <p:column headerText="Classifier">
                            <h:outputText value="#{pack.classifier}"/>
                        </p:column>

                        <p:column headerText="Valid From">
                            <h:outputText value="#{transformBean.dateToString(pack.validFrom)}"/>
                        </p:column>

                        <p:column headerText="Valid To">
                            <h:outputText value="#{transformBean.dateToString(pack.validTo)}"/>
                        </p:column>

                        <p:column>
                            <p:commandButton update="app-form" icon="pi pi-upload"
                                             action="#{configurationsBean.applyConfiguration(pack.id)}"
                                             onclick="PF('loading-spin').show()"
                                             oncomplete="configApplied()"/>
                        </p:column>

                    </p:dataTable>
                </p:panel>

                <p:panel rendered="#{modemDataBean.page == 'CHARTS'}">
                    <div class="card">
                        <p:poll widgetVar="dataRatePoll" autoStart="true" update="dataRateChart berChart"
                                listener="#{modemDataBean.refreshChartData()}"
                                interval="10"/>
                        <p:lineChart id="dataRateChart" model="#{modemDataBean.dataRateChart}"
                                     style="width: 100%; height: 300px;"/>
                        <p:lineChart id="berChart" model="#{modemDataBean.berChart}"
                                     style="width: 100%; height: 300px;"/>
                    </div>
                </p:panel>

                <p:panel rendered="#{modemDataBean.page == 'SETTINGS'}">
                    <p:commandButton update="app-form" value="Deactivate"
                                     action="#{modemDataBean.stopModem()}"
                                     oncomplete="configApplied()"/>
                </p:panel>

            </div>

        </div>
    </p:panel>
</h:form>

<h:form>
    <p:poll widgetVar="spin-closer" interval="5" oncomplete="PF('loading-spin').hide()"/>

    <p:dialog widgetVar="loading-spin" header="Applying Configuration" onShow="PF('spin-closer').start()"
              showEffect="fade"
              modal="true" closable="false">
        <i class="pi pi-spin pi-spinner" style="margin-left: 40%;font-size: 2rem"/>
    </p:dialog>
</h:form>
</body>
</html>